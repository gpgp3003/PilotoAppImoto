<!DOCTYPE html>
<html onclick="limpaFiltro(event)">
<head>
<meta charset="utf-8" />
<meta name="format-detection" content="telephone=no" />
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="css/custom.css" />
<title>iMotopeças</title>
<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/index.js"></script>
<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="js/popper.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/mask.js"></script>
<script type="text/javascript">
var idCtg = 0;
var arrCtg = [];
var produtos = [];
var lastIdx = 0;
document.addEventListener("deviceready", onDeviceReady, false);
function onDeviceReady(){
    document.addEventListener("backbutton", onBackKeyDown, false);
    startMenu(JSON.parse(window.localStorage.getItem("imotoCateg")));
    getUrlVars();
}
    
function onBackKeyDown() {
    if(device.platform=="iOS"){
        history.go(-1);
    } else if(device.platform=="Android") {
        navigator.app.backHistory();
    }
}

function getUrlVars(){
	var parameters = location.search.substring(1).split("&");
	var getTipo = parameters[0].split("=");
    var tipo = unescape(getTipo[1]);
	var getCtg = parameters[1].split("=");
    idCtg = unescape(getCtg[1]);
    if(tipo==1){
        selCateg(JSON.parse(window.localStorage.getItem("imotoCateg")));
    } else {
        selSubCateg(JSON.parse(window.localStorage.getItem("imotoCateg")));
    }
}

function selSubCateg(objCateg){
    $.each(objCateg.info, function(i, dados){
        var categ = JSON.parse(dados);
        if(categ.IdCat==idCtg){
            var idCatPai = categ.IdCatPai;
            $.each(objCateg.info, function(j, dadospai){
                var categpai = JSON.parse(dadospai);
                if(categpai.IdCat==idCatPai){
                    $('#titCateg').text(categpai.Categoria + ' > ' + categ.Categoria);
                }
            });
        }
    });
    loadIdProd();
}

function selCateg(objCateg){
    $.each(objCateg.info, function(i, dados){
        var categ = JSON.parse(dados);
        if(categ.IdCat==idCtg){
            $('#titCateg').text(categ.Categoria);
        }
    });
    loadIdProd();
}

function loadFullProdList(){
    var tblRow = '<div class="card mt-3 rounded boxshadow border-0"><div class="card-body"><p class="card-text">Não foram encontrados produtos</p></div></div>';
    $(tblRow).appendTo('#tbProd');
}

function loadIdProd(){
    showAppIcon();
    //var urlServer = strServer + "/productbychild.php?idCtg=" + idCtg;
    var urlServer = strServer + "/productbycategory.php?idCtg=" + idCtg;
    $.getJSON(urlServer, function(result){
        window.setTimeout(function() {
            hideAppIcon();
            produtos=result.info;
            if(result.info.length==0){
                loadFullProdList();
            } else {
                loadProd(0);
            }
        }, 500);
    }).error(function(err) {
        hideAppIcon();
        alert("Não foi possível realizar a conexão com o Banco de Dados: " + err);
    }).done(function() {
        //
    });
}

function loadProd(cont){
    if((lastIdx + cont) <= (produtos.length + 1)){
        var idx = lastIdx + cont;
        var idPrd = JSON.parse(produtos[idx]).product_id;
        if(idPrd>0){
            showAppIcon();
            lastIdx = lastIdx + cont;
            var urlServer = strServer + "/productlist.php?idPrd=" + idPrd;
            $.getJSON(urlServer, function(result){
                window.setTimeout(function() {
                    hideAppIcon();
                    var tblImg = '';
                    var price = 0.0;
                    var name = '';
                    $.each(result.info, function(i, dados){
                        var prod = JSON.parse(dados);
                        var idAttr = prod.attribute_id;
                        //foto: id = 85
                        if(idAttr==85){
                            tblImg = '<img class="card-img-top" src="https://dev.imotopecas.com.br/media/catalog/product' + prod.value + '" alt="" onclick="goToProd(' + idPrd + ');">';
                        }
                        //nome: id = 71
                        if(idAttr==71){
                            name = prod.value;
                        }
                        //price: id = 75
                        if(idAttr==75){
                            price=Number(prod.value).toFixed(2);
                        }
                    });
                    var tblRow = '<div class="card mt-3 rounded boxshadow border-0">' + tblImg + '<div class="card-body" onclick="goToProd(' + idPrd + ');"><p class="card-text">' + name + '<br>' + toBRL(price) + '</p></div></div>';
                    $(tblRow).appendTo('#tbProd');
                    if(cont<4){
                        cont = cont + 1;
                        loadProd(cont);
                    }
                }, 500);
            }).error(function(err) {
                hideAppIcon();
                alert("Não foi possível realizar a conexão com o Banco de Dados: " + err);
            });
        }
    }
}

function goToProd(idPrd){
    window.location = "./product.html?idPrd=" + idPrd;
}

function detectScroll(){
    var scrollHeight = $(document).height();
    var scrollPosition = $(window).height() + $(window).scrollTop();
    if((scrollHeight - scrollPosition) / scrollHeight === 0){
        if($("#spinner").css('display') == 'none') {
            loadProd(1);
        }
    }
}

</script>
<style type="text/css">
html {
    /*background: url('./img/backgroundXS.png');*/
    background-position: fixed;
    background-repeat: repeat-y;
    background-size:  100% auto;
    -webkit-background-size: 100% auto;
    -moz-background-size: 100% auto;
    -o-background-size: 100% auto;
}
#div-filtro{
    padding: 0 0 0 4%;
}
.btn{
    padding: 0 0 0 0;
}
#filtro-categorias{
    margin-left: 7%;
}

.slider {
    -webkit-appearance: none;
    width: 100%;
    height: 15px;
    border-radius: 5px;   
    background: #d3d3d3;
    outline: none;
    opacity: 0.7;
    -webkit-transition: .2s;
    transition: opacity .2s;
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 25px;
    height: 25px;
    border-radius: 50%; 
    background: #ff1a1a;
    cursor: pointer;
}

.slider::-moz-range-thumb {
    width: 25px;
    height: 25px;
    border-radius: 50%;
    background: #ff1a1a;
    cursor: pointer;
}

#bt-preco:hover > #seta-preco-img{
    -webkit-transform: rotate(90deg);
    -moz-transform: rotate(90deg);
    -o-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
    transform: rotate(90deg);
}


.btn:hover {
  text-decoration: none;
  background-color: transparent;
  border-color: transparent;
}

.btn-light:hover {
  text-decoration: none;
  background-color: transparent;
  border-color: transparent;
}

#radioBtn .notActive{
    color: #b3b3b3;
    background-color: #fff;
}
#radioBtn{
    color: #b3b3b3;
}

</style>
</head>
<body class="panel panel-transparent bg-light" onscroll="detectScroll();" >
<img src="./glyphicons/glyphicons-217-circle-arrow-left.png" id="backimg" onclick="onBackKeyDown();" width="30px" height="30px">
<nav class="navbar navbar-light fixed-top navbar-default bg-white" >
    <div class="navbar-brand">
        <!--<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggleExternalContent" aria-controls="navbarToggleExternalContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>-->
        <button type="button" class="btn btn-light d-inline-block align-center button-menu" alt="" onclick="showhidemenu();"><img src="./glyphicons/glyphicons-517-menu-hamburger.png" width="25" height="18"></button>
        <a class="d-inline-block align-center" href="index.html"><img src="./img/Logo.png" width="123" height="30" alt=""></a>
    </div>
</nav>

<div class="bg-light" id="CategoriesMenu">
    <div class="list-group list-group-flush bg-light" id="menuInicio">
        <h5 class="text-dark m-3 h4">Todos os departamentos<hr></h5>
    </div>
</div>
<!--<div class="input-group mb-3 search-box" id="searchBox">
    <input type="text" id="txPesquisa" class="form-control" placeholder="Pesquise..." aria-label="Filtrar" aria-describedby="btPesquisa">
    <div class="input-group-append">
        <span class="input-group-text glyphicon glyphicon-search" aria-hidden="true">
            <img src="./glyphicons/glyphicons-28-search.png" width="20" height="20" alt="" onclick="searchProd();">
        </span>
    </div>
</div>-->

<div class="container" id="mainbody">

        <div class="row" id="div-filtro"> 
            <a class="list-group-item list-group-item-action flex-column align-items-start bg-light p4 text-dark h6 border-1 mr-4" data-toggle="collapse" href="#filtro-categorias">
                    <img src="./glyphicons/glyphicons-321-filter.png" width="10" height="15"> 
                    Filtrar
            </a>                    
        </div>

        <div class="collapse mt-2" id="filtro-categorias">
                <div class="row">
                    <div class="col">
                        <a class="flex-column align-items-start bg-light p4 text-dark h6 border-1 mr-4" data-toggle="collapse" href="#ordenacao" >
                            <img src="glyphicons/glyphicons-404-sorting.png" width="20" height="17">
                            Ordenar...
                        </a>
                    </div>
                    <div class="col">
                        <a class="flex-column align-items-start bg-light p4 pr-2 text-dark h6 border-1 float-right mr-2" href="#">
                            <img src="glyphicons/glyphicons-68-cleaning.png" width="20" height="17">
                            Limpar Filtro
                        </a>
                    </div>
                </div>

                <div class="collapse mb-2" id="ordenacao">
                        <div class="input-group">
                                <div id="radioBtn" class="btn-group">
                                    <a class="btn btn-outline-danger pr-1 pl-1 mt-1" data-toggle="ordenacao" data-title="Relevância">
                                        <b>Relevância</b>
                                    </a>
                                    <a class="btn btn-outline-danger pr-1 pl-1 mt-1" data-toggle="ordenacao" data-title="Nome">
                                        <b>Nome</b>
                                    </a>
                                    <a class="btn btn-outline-danger pr-1 pl-1 mt-1" data-toggle="ordenacao" data-title="Preço">
                                        <b>Preço</b>
                                    </a>
                                    <a class="btn btn-outline-danger pr-1 pl-1 mt-1" data-toggle="ordenacao" data-title="Marca">
                                        <b>Marca</b>
                                    </a>
                                </div>
                                <input type="hidden" name="ordenacao" id="ordenacao">
                            </div>
                </div>
                <div class="row">
                        <a class="list-group-item list-group-item-action flex-column align-items-start bg-light p4 text-dark h6 border-1 mb-2 mr-4" data-toggle="collapse" href="#subcategoria-categoria" >
                                Categoria
                                <img class="float-right" src="glyphicons/glyphicons-224-chevron-right.png" width="10" height="15"> 
                        </a>                    
                </div>
                <div class="collapse" id="subcategoria-categoria">

                        <div class="custom-control custom-checkbox mr-sm-2 pb-2">
                                <input type="checkbox" class="custom-control-input" id="bateria">
                                <label class="custom-control-label" for="bateria">Bateria</label>
                                <b>(10)</b>
                        </div>
                        <div class="custom-control custom-checkbox mr-sm-2 pb-2">
                                <input type="checkbox" class="custom-control-input" id="cabo">
                                <label class="custom-control-label" for="cabo">Cabo</label>
                                <b>(4)</b>
                        </div>
                        <div class="custom-control custom-checkbox mr-sm-2 pb-2">
                                <input type="checkbox" class="custom-control-input" id="car">
                                <label class="custom-control-label" for="car">Carenagem</label>
                                <b>(4)</b>
                        </div>

                </div>

                <div class="row">
                        <a class="list-group-item list-group-item-action flex-column align-items-start bg-light p4 text-dark h6 border-1 mb-2 mr-4" data-toggle="collapse" href="#subcategoria-estado" >
                                Estado - UF
                                <img class="float-right" src="glyphicons/glyphicons-224-chevron-right.png" width="10" height="15"> 
                        </a>      
                </div>
                <div class="collapse" id="subcategoria-estado">
                            <div class="custom-control custom-checkbox mr-sm-2 pb-2">
                              <input type="checkbox" class="custom-control-input" id="sp">
                              <label class="custom-control-label" for="sp">SP</label>
                              <b>(100)</b>
                            </div>
                </div>

                <div class="row">
                        <a class="list-group-item list-group-item-action flex-column align-items-start bg-light p4 text-dark h6 border-1 mb-2 mr-4" data-toggle="collapse" href="#subcategoria-produto" >
                                Produto
                                <img class="float-right" src="glyphicons/glyphicons-224-chevron-right.png" width="10" height="15"> 
                        </a>      
                </div>
                <div class="collapse" id="subcategoria-produto">
                        <div class="custom-control custom-checkbox mr-sm-2 pb-2">
                                <input type="checkbox" class="custom-control-input" id="cap">
                                <label class="custom-control-label" for="cap">Capacete</label>
                                <b>(80)</b>
                        </div>
                        <div class="custom-control custom-checkbox mr-sm-2 pb-2">
                                <input type="checkbox" class="custom-control-input" id="pneu">
                                <label class="custom-control-label" for="pneu">Pneu</label>
                                <b>(2)</b>
                        </div>
                        <div class="custom-control custom-checkbox mr-sm-2 pb-2">
                                <input type="checkbox" class="custom-control-input" id="luva">
                                <label class="custom-control-label" for="luva">Luva</label>
                                <b>(10)</b>
                        </div>
                        <div class="custom-control custom-checkbox mr-sm-2 pb-2">
                                <input type="checkbox" class="custom-control-input" id="retro">
                                <label class="custom-control-label" for="retro">Retrovisor</label>
                                <b>(1)</b>
                        </div>
                </div>

                <div class="row">
                        <a class="list-group-item list-group-item-action flex-column align-items-start bg-light p4 text-dark h6 border-1 mb-2 mr-4" data-toggle="collapse" href="#subcategoria-marca" >
                                Marca
                                <img class="float-right" src="glyphicons/glyphicons-224-chevron-right.png" width="10" height="15"> 
                        </a>      
                </div>
                <div class="collapse" id="subcategoria-marca">
                        <div class="custom-control custom-checkbox mr-sm-2 pb-2">
                                <input type="checkbox" class="custom-control-input" id="honda">
                                <label class="custom-control-label" for="honda">Honda</label>
                                <b>(2)</b>
                        </div>
                        <div class="custom-control custom-checkbox mr-sm-2 pb-2">
                                <input type="checkbox" class="custom-control-input" id="suz">
                                <label class="custom-control-label" for="suz">Suzuki</label>
                                <b>(5)</b>
                        </div>
                </div>

                <div class="row">
                        <a class="list-group-item list-group-item-action flex-column align-items-start bg-light p4 text-dark h6 border-1 mb-2 mr-4" data-toggle="collapse" href="#subcategoria-material" >
                                Material
                                <img class="float-right" src="glyphicons/glyphicons-224-chevron-right.png" width="10" height="15"> 
                        </a>      
                </div>
                <div class="collapse" id="subcategoria-material">
                        <div class="custom-control custom-checkbox mr-sm-2 pb-2">
                                <input type="checkbox" class="custom-control-input" id="couro">
                                <label class="custom-control-label" for="couro">Couro</label>
                                <b>(2)</b>
                        </div>
                </div>

                <div class="row">
                        <a class="list-group-item list-group-item-action flex-column align-items-start bg-light p4 text-dark h6 border-1 mb-2 mr-4" data-toggle="collapse" href="#subcategoria-cor" >
                            Cor
                            <img class="float-right" src="glyphicons/glyphicons-224-chevron-right.png" width="10" height="15"> 
                        </a>   
                </div>
                <div class="collapse" id="subcategoria-cor">
                        <div class="custom-control custom-checkbox mr-sm-2 pb-2">
                                <input type="checkbox" class="custom-control-input" id="az">
                                <label class="custom-control-label" for="az">Azul</label>
                                <b>(10)</b>
                        </div>
                        <div class="custom-control custom-checkbox mr-sm-2 pb-2">
                                <input type="checkbox" class="custom-control-input" id="ver">
                                <label class="custom-control-label" for="ver">Vermelho</label>
                                <b>(4)</b>
                        </div>
                </div>

                <div class="row">
                        <a class="list-group-item list-group-item-action flex-column align-items-start bg-light p4 text-dark h6 border-1 mb-2 mr-4" data-toggle="collapse" href="#subcategoria-preco" >
                            Preço
                            <img class="float-right" src="glyphicons/glyphicons-224-chevron-right.png" width="10" height="15"> 
                        </a>   
                </div>
                <div class="collapse slidecontainer" id="subcategoria-preco">
                    <input type="range" id="myRange" value="1" max="100" class="slider mt-3">
                    <b><div class="row pl-3">R$<div id="demo">1</div>,00</div></b>
                </div>

            </div>        


        </div>

    <!--<div class="card mt-3 rounded boxshadow border-0">
        <a class="card-body">
            <img class="float-left mr-3" width="45" height="25" src="./img/moto.png" alt="">
            <p class="card-text">Peças e Acessórios para você e sua moto, confira!</p>
        </a>
    </div>-->

    <!--<h5 class="m-3 h4">Destaques</h5>-->
    <div class="list-group" id="tbProd">
    </div>

</div>

</body>
<script>
$('#radioBtn a').on('click', function(){
var sel = $(this).data('title');
var tog = $(this).data('toggle');
$('#'+tog).prop('value', sel);

$('a[data-toggle="'+tog+'"]').not('[data-title="'+sel+'"]').removeClass('active').addClass('notActive');
$('a[data-toggle="'+tog+'"][data-title="'+sel+'"]').removeClass('notActive').addClass('active');
});

$('#txPesquisa').keypress(function(event) {
    var keycode = (event.keyCode ? event.keyCode : event.which);
    if(keycode == '13'){
        searchProd();
    }
});
//função da para que seleciona o preço
var slider = document.getElementById("myRange");
var output = document.getElementById("demo");
output.innerHTML = slider.value; // Display the default slider value

// Update the current slider value (each time you drag the slider handle)
slider.oninput = function() {
    output.innerHTML = this.value;
}

function limpaFiltro(e){
    var $target = $(e.target);
    if (!$target.is('#filtro-categorias') &&
        !$target.parents('#filtro-categorias').length) {
        $(".collapse").collapse('hide');
    }
}

</script>
</html>